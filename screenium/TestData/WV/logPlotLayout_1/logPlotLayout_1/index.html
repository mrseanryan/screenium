<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>log plot layout tryout</title>

	<!--=== CSS ========================================================-->
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">

	<link href="http://cdn.kendostatic.com/2015.2.624/styles/kendo.common.min.css" rel="stylesheet" />
	<link href="http://cdn.kendostatic.com/2015.2.624/styles/kendo.default.min.css" rel="stylesheet" />

	<link rel="stylesheet" href="http://yui.yahooapis.com/combo?pure/0.6.0/base-min.css&pure/0.6.0/grids-min.css&pure/0.6.0/grids-responsive-min.css">
	<link href="Styles/logPlotHeader.css" rel="stylesheet" />

	<!--=== JAVASCRIPT ========================================================-->
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

	<script src="http://cdn.kendostatic.com/2015.2.624/js/kendo.all.min.js"></script>
	<!--<script src="http://cdn.kendostatic.com/2015.2.624/js/kendo.timezones.min.js"></script>-->

	<script src="Scripts/LogPlotLayoutCreator.js"></script>
	<script src="Scripts/LogPlotHeaderLayoutPartsCreator.js"></script>
	<script src="Scripts/LogPlotHeaderLayout.js"></script>
	<script src="Scripts/LogPlotSeriesHeaderLayoutStrategy.js"></script>
	<script src="Scripts/LogPlotSeriesHeaderLayout.js"></script>
</head>
<body>

<!-- WV uses tables for zones:-->
<table>
	<tr>
		<td id="tdZone1" width="600px">
			<div id="zone1">

				<!-- LP will be created here in zone 1 -->
				<script>
					var getHtmlForImage = function(url) {
						return $("<img src='" + url + "' class='stretch-image' />");
					};

					var cloneObject = function(obj) {
						return JSON.parse(JSON.stringify(obj));
					}

					var LogPlotHeaderConfig = function (showName, showUom, showMetadataIndicators, showSnapshotValue) {
						this.showHeader = true;
						this.position = JsApiLogPlotHeaderPosition.TopAndBottom;
						this.showName = showName;
						this.showUom = showUom;
						this.showMetadataIndicators = showMetadataIndicators;
						this.showSnapshotValue = showSnapshotValue;
						this.showScaleIntervals = true;
						this.minHeight = 60;
					};

					/** @function
					* @description Auto-generate configs so we can more easily test the various permutations.
					*/
					var generateSeriesHeaderConfigs = function(defaultConfig, isWithValue) {
						var configs = [];
						configs.push(defaultConfig);

						var properties = [
							'showName',
							'showUom',
							'showMetadataIndicators'
						];

						var configCount = Math.pow(2, properties.length);
						for (var i = 0; i < configCount; i++) {
							var config = new LogPlotHeaderConfig(false, false, false, isWithValue);
							for (var p = 0; p < properties.length; p++) {
							
								//is this property ON for this config:
								if (i & Math.pow(2,p)) {
									config[properties[p]] = true;
								}
							}
							configs.push(config);
						};

						return configs;
					};

					$(document).ready(function () {
						var defaultHeaderConfig = new LogPlotHeaderConfig(true, true, true, false);
						defaultHeaderConfig.position = JsApiLogPlotHeaderPosition.Top;

						var headerLayoutCreator = new LogPlotHeaderLayout(defaultHeaderConfig);
						var callback = {
							fireOnResizeLayout: function () {
								headerLayoutCreator.onResizeLayout();
							}
						};

						var layout = new LogPlotLayoutCreator('zone1', callback);
						
						//TESTING:
						//We only width for so many columns, so need to split the test cases.
						//To test WITHOUT value, then comment out the second line:
						var perSeriesHeaderConfigs = generateSeriesHeaderConfigs(defaultHeaderConfig, false);
						perSeriesHeaderConfigs = generateSeriesHeaderConfigs(defaultHeaderConfig, true);

						var columnCount = 1 + perSeriesHeaderConfigs.length,
							rulerPosition = 1,
							initialWidth = 1200,
							initialHeight = 700;
						layout.construct(columnCount, rulerPosition, initialWidth, initialHeight);

						//populate the layout so we have something to look at:
						layout.getHeaderDivForRuler().html(getHtmlForImage('images/wv_lp_ruler_heading.png'));
						layout.getMainDivForRuler().html(getHtmlForImage('images/wv_lp_ruler_main.png'));

						var seriesInColumn = [
							{
								Id: 0,
								Name: "r1s"
							},
							{
								Id: 1,
								Name: "at"
							},
							{
								Id: 2,
								Name: "sin_1s"
							}
						];
						var maxSeriesInColumn = 3;

						for(var c = 1; c < columnCount; c++) {
							var seriesThisColumn = cloneObject(seriesInColumn);

							//give unique ids:
							for(var s = 0; s < seriesThisColumn.length; s++) {
								seriesThisColumn[s].Id += c * 100;
							}

							//make 1 column with less series:
							if(c === columnCount - 1) {
								seriesThisColumn.pop();
							}

							headerLayoutCreator.constructColumnHeader(layout.getHeaderDivForColumn(c), seriesThisColumn, maxSeriesInColumn, perSeriesHeaderConfigs[c - 1]);
							layout.getMainDivForColumn(c).html(getHtmlForImage("images/wv_lp_column" + c + "_main.png"));
							headerLayoutCreator.constructColumnFooter(layout.getValueAxisDivForColumn(c), seriesThisColumn, maxSeriesInColumn, perSeriesHeaderConfigs[c - 1]);

							//test that we can ALWAYS set some content, like the LogPlotView would:
							var firstSerieThisColumn = seriesThisColumn[0];

							var serieParts = headerLayoutCreator.getSerieParts(firstSerieThisColumn, true);

							var newValue = (1000 * firstSerieThisColumn.Id) + 654.321;
							serieParts.findDivHtmlForValue().html(newValue);

							var newName = 'serie ' + firstSerieThisColumn.Id;
							serieParts.findDivHtmlForName().html(newName);

							//TODO new class LogPlotSeriesHeaderMetadataLayout
							var newMetadata = firstSerieThisColumn.Id.toString().substr(0, 2);
							serieParts.findDivHtmlForMetadata().html(newMetadata);

							var newUnits = '[' + firstSerieThisColumn.Id + ']';
							serieParts.findDivHtmlForUnits().html(newUnits);

							var valueAxis = '{va' + firstSerieThisColumn.Id + '}';
							serieParts.findDivHtmlForValueAxis().html(valueAxis);
						}
					});
				</script>

				<style>
					#vertical {
						margin: 0 auto;
					}

					.pane-content {
						padding: 0 10px;
					}

					.stretch-image {
						margin: 0;
						height: 99%;
						width: 100%;
					}

					.dropTargetEntered {
						border: cyan solid 2px;
						-ms-border-radius: 10px;
						border-radius: 10px;
					}

					.draggableOnDrag {
						border: yellow solid 2px;
						-ms-border-radius: 10px;
						border-radius: 10px;
						background-color: #03a9f4;
						-webkit-box-shadow: 0 3px 10px #000000, 0 3px 10px #000000;
						-ms-box-shadow: 0 3px 10px #000000, 0 3px 10px #000000;
						box-shadow: 0 3px 10px #000000, 0 3px 10px #000000;
					}
				</style>
			</div>
		</td>
	</tr>
</table>

</body>
</html>
